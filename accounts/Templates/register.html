{% extends 'base.html' %}

{% block title %}Registro - Tienda de Julian{% endblock %}

{% block content %}
<div style="max-width: 600px; margin: 0 auto; padding-top: 2rem;">
    <!-- Hero section para registro -->
    <div class="hero" style="margin-bottom: 2rem; padding: 2rem;">
        <h1 class="hero-title" style="font-size: 2.5rem; margin-bottom: 0.5rem;">
            Crear Cuenta
        </h1>
        <p class="hero-subtitle">
            Únete a nosotros y comienza a explorar
        </p>
    </div>

    <!-- Mensajes de feedback -->
    {% if messages %}
        {% for message in messages %}
            <div class="message message-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <!-- Formulario de registro -->
    <div class="card">
        <form method="post" id="registerForm">
            {% csrf_token %}

            <!-- Grid para nombre y apellido -->
            <div class="grid grid-2" style="gap: 1rem;">
                <div class="form-group">
                    <label for="first_name" class="form-label">
                        <i class="icon-user" style="margin-right: 0.5rem;"></i>
                        Nombre
                    </label>
                    <input 
                        type="text" 
                        id="first_name" 
                        name="first_name" 
                        class="form-input" 
                        placeholder="Tu nombre"
                        value="{{ request.POST.first_name|default:'' }}"
                        autocomplete="given-name"
                    >
                </div>

                <div class="form-group">
                    <label for="last_name" class="form-label">
                        <i class="icon-user" style="margin-right: 0.5rem;"></i>
                        Apellido
                    </label>
                    <input 
                        type="text" 
                        id="last_name" 
                        name="last_name" 
                        class="form-input" 
                        placeholder="Tu apellido"
                        value="{{ request.POST.last_name|default:'' }}"
                        autocomplete="family-name"
                    >
                </div>
            </div>

            <div class="form-group">
                <label for="username" class="form-label">
                    <i class="icon-at" style="margin-right: 0.5rem;"></i>
                    Nombre de Usuario *
                </label>
                <input 
                    type="text" 
                    id="username" 
                    name="username" 
                    class="form-input" 
                    required
                    autocomplete="username"
                    placeholder="Elige un nombre de usuario único"
                    value="{{ request.POST.username|default:'' }}"
                >
                <div id="usernameStatus" class="input-status"></div>
            </div>

            <div class="form-group">
                <label for="email" class="form-label">
                    <i class="icon-mail" style="margin-right: 0.5rem;"></i>
                    Correo Electrónico *
                </label>
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    class="form-input" 
                    required
                    autocomplete="email"
                    placeholder="tu@gmail.com"
                    value="{{ request.POST.email|default:'' }}"
                >
            </div>

            <div class="form-group">
                <label for="password" class="form-label">
                    <i class="icon-lock" style="margin-right: 0.5rem;"></i>
                    Contraseña *
                </label>
                <input 
                    type="password" 
                    id="password" 
                    name="password" 
                    class="form-input" 
                    required
                    autocomplete="new-password"
                    placeholder="Mínimo 8 caracteres"
                    minlength="8"
                >
                <div class="password-strength" id="passwordStrength"></div>
            </div>

            <div class="form-group">
                <label for="password2" class="form-label">
                    <i class="icon-lock" style="margin-right: 0.5rem;"></i>
                    Confirmar Contraseña *
                </label>
                <input 
                    type="password" 
                    id="password2" 
                    name="password2" 
                    class="form-input" 
                    required
                    autocomplete="new-password"
                    placeholder="Repite tu contraseña"
                >
                <div id="passwordMatch" class="input-status"></div>
            </div>

            <div class="form-group" style="margin-bottom: 2rem;">
                <button type="submit" class="btn btn-primary" style="width: 100%; position: relative;">
                    <span class="btn-text">Crear Cuenta</span>
                    <div class="loading" id="registerLoader" style="display: none; margin-left: 0.5rem;"></div>
                </button>
            </div>

            <div style="text-align: center; color: var(--gray-600);">
                <p>
                    ¿Ya tienes cuenta? 
                    <a href="{% url 'accounts:login' %}" style="color: var(--primary-color); text-decoration: none; font-weight: 600;">
                        Inicia sesión aquí
                    </a>
                </p>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const registerForm = document.getElementById('registerForm');
    const registerLoader = document.getElementById('registerLoader');
    const btnText = document.querySelector('.btn-text');
    
    // Elementos del formulario
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const password2Input = document.getElementById('password2');
    const usernameStatus = document.getElementById('usernameStatus');
    const passwordStrength = document.getElementById('passwordStrength');
    const passwordMatch = document.getElementById('passwordMatch');

    // Validación en tiempo real del username
    let usernameTimeout;
    usernameInput.addEventListener('input', function() {
        clearTimeout(usernameTimeout);
        const username = this.value.trim();
        
        if (username.length >= 3) {
            usernameTimeout = setTimeout(() => {
                checkUsernameAvailability(username);
            }, 500);
        } else {
            usernameStatus.innerHTML = '';
        }
    });

    // Función para verificar disponibilidad del username
    function checkUsernameAvailability(username) {
        // En un entorno real, harías una petición AJAX a tu API
        // Por ahora simulamos una validación básica
        if (username.length >= 3) {
            usernameStatus.innerHTML = '<span style="color: var(--success-color); font-size: 0.875rem;">✓ Nombre de usuario disponible</span>';
        }
    }

    // Validación de fortaleza de contraseña
    passwordInput.addEventListener('input', function() {
        const password = this.value;
        let strength = 0;
        let feedback = [];

        if (password.length >= 8) strength++;
        else feedback.push('Mínimo 8 caracteres');

        if (/[A-Z]/.test(password)) strength++;
        else feedback.push('Una mayúscula');

        if (/[a-z]/.test(password)) strength++;
        else feedback.push('Una minúscula');

        if (/[0-9]/.test(password)) strength++;
        else feedback.push('Un número');

        if (/[^A-Za-z0-9]/.test(password)) strength++;
        else feedback.push('Un símbolo');

        // Mostrar indicador de fortaleza
        let strengthText = '';
        let strengthColor = '';
        
        if (strength <= 2) {
            strengthText = 'Débil';
            strengthColor = 'var(--error-color)';
        } else if (strength <= 3) {
            strengthText = 'Media';
            strengthColor = 'var(--warning)';
        } else {
            strengthText = 'Fuerte';
            strengthColor = 'var(--success-color)';
        }

        if (password.length > 0) {
            passwordStrength.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem; margin-top: 0.25rem;">
                    <div style="flex: 1; height: 4px; background: var(--gray-200); border-radius: 2px;">
                        <div style="height: 100%; background: ${strengthColor}; width: ${(strength/5)*100}%; border-radius: 2px; transition: all 0.3s ease;"></div>
                    </div>
                    <span style="font-size: 0.75rem; color: ${strengthColor}; font-weight: 500;">${strengthText}</span>
                </div>
            `;
        } else {
            passwordStrength.innerHTML = '';
        }
    });

    // Validación de coincidencia de contraseñas
    password2Input.addEventListener('input', function() {
        const password = passwordInput.value;
        const password2 = this.value;

        if (password2.length > 0) {
            if (password === password2) {
                passwordMatch.innerHTML = '<span style="color: var(--success-color); font-size: 0.875rem;">✓ Las contraseñas coinciden</span>';
            } else {
                passwordMatch.innerHTML = '<span style="color: var(--error-color); font-size: 0.875rem;">✗ Las contraseñas no coinciden</span>';
            }
        } else {
            passwordMatch.innerHTML = '';
        }
    });

    // Envío del formulario
    registerForm.addEventListener('submit', function(e) {
        // Mostrar loading
        registerLoader.style.display = 'inline-block';
        btnText.textContent = 'Creando cuenta...';
        
        // Deshabilitar el botón
        const submitBtn = registerForm.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
    });

    // Animación en focus de inputs
    const inputs = document.querySelectorAll('.form-input');
    inputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.parentElement.style.transform = 'scale(1.02)';
            this.parentElement.style.transition = 'transform 0.3s ease';
        });
        
        input.addEventListener('blur', function() {
            this.parentElement.style.transform = 'scale(1)';
        });
    });
});
</script>

<style>
/* Iconos para el registro */
.icon-user::before {
    content: "👤";
}

.icon-at::before {
    content: "@";
}

.icon-mail::before {
    content: "📧";
}

.icon-lock::before {
    content: "🔒";
}

/* Estilos para estados de validación */
.input-status {
    margin-top: 0.25rem;
    min-height: 1.25rem;
}

.password-strength {
    margin-top: 0.25rem;
    min-height: 1.5rem;
}

/* Grid responsive para nombre y apellido */
@media (max-width: 768px) {
    .grid-2 {
        grid-template-columns: 1fr;
    }
}

/* Responsive para formulario */
@media (max-width: 480px) {
    .hero {
        padding: 1.5rem 1rem;
    }
    
    .hero-title {
        font-size: 2rem;
    }
    
    .card {
        padding: 1.5rem;
        margin: 0 1rem;
    }
}

/* Mejoras visuales */
.card:hover {
    transform: translateY(-2px);
}

/* Animación para campos requeridos */
.form-label:has(+ input[required])::after {
    content: " *";
    color: var(--error-color);
}
</style>
{% endblock %}